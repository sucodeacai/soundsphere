!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.tsPromise=t()}}(function(){return function(){function t(e,n,i){function o(s,u){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!u&&c)return c(s,!0);if(r)return r(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var a=n[s]={exports:{}};e[s][0].call(a.exports,function(t){var n=e[s][1][t];return o(n||t)},a,a.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}return t}()({1:[function(t,e,n){"use strict";var i=this&&this.a||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function e(e,n){var i=this.constructor,o=t.call(this,n)||this,r=!1;if(o.constructor!==i&&(Object.setPrototypeOf&&Object.setPrototypeOf(o,i.prototype),r=!0),"stack"in o||(r=!0),o.name=e,r)if(Error.captureStackTrace)Error.captureStackTrace(o,i);else{var s=new Error(n);s.name=e;try{throw s}catch(t){o.stack=t.stack||String(t)}}return o}return i(e,t),e}(Error);n.default=o},{}],2:[function(t,e,n){"use strict";function i(t,e){}function o(){}function r(t){return t}Object.defineProperty(n,"__esModule",{value:!0});var s,u,c=t("./async"),f=t("./rejections"),a=t("./Trace"),h=t("./util"),l=!1;!function(t){t[t.Pending=0]="Pending",t[t.Fulfilled=1]="Fulfilled",t[t.Rejected=2]="Rejected"}(u||(u={}));var d;!function(t){t[t.RejectionHandled=1]="RejectionHandled",t[t.UnhandledRejectionNotified=2]="UnhandledRejectionNotified"}(d||(d={})),i(void 0,void 0);var p,y={error:void 0},v=new a.default,j=0,Promise=function(){function Promise(t){var e=this;if(this.b=j++,this.c=0,this.d=void 0,this.e=void 0,this.f=0,this.g=void 0,s&&s(this,"construct"),l&&(this.g=new a.default(Promise),p&&this.h(p)),t!==i){if("function"!=typeof t)throw new TypeError("Promise resolver is not a function");var n=!1;try{t(function(t){n||(n=!0,e.i(t))},function(t){n||(n=!0,e.j(r(t)))})}catch(t){n||(n=!0,this.j(r(t)))}}}return Promise.prototype.then=function(t,e){if(s&&s(this,"then("+typeof t+", "+typeof e+")"),1===this.c&&"function"!=typeof t||2===this.c&&"function"!=typeof e)return this;var n=new(Object.getPrototypeOf(this).constructor)(i);return n.h(this),this.k(t,e,n,void 0),n},Promise.prototype.done=function(t,e){if(s&&s(this,"done("+typeof t+", "+typeof e+")"),1!==this.c||"function"==typeof t){var n=v;l&&(n=new a.default,this.g&&n.setSource(this.g)),this.k(t,e,void 0,n)}},Promise.prototype.catch=function(){if(1===arguments.length){var t=arguments[0];return this.then(void 0,t)}var e=arguments[0],n=arguments[1];return this.then(void 0,function(t){var i=!1;if("function"==typeof e)i=e.prototype instanceof Error||e===Error?t instanceof e:e(t);else{if(!Array.isArray(e))throw new TypeError("invalid predicate to .catch(), got "+typeof e);for(var o=0,r=e;o<r.length;o++){var s=r[o];if(t instanceof s){i=!0;break}}}return i?n(t):Promise.reject(t)})},Promise.prototype.finally=function(t){var e=this,n=function(){return t(e)};return this.then(n,n).return(this)},Promise.prototype.isFulfilled=function(){return 1===this.c},Promise.prototype.isRejected=function(){return 2===this.c},Promise.prototype.isPending=function(){return 0===this.c},Promise.prototype.value=function(){if(!this.isFulfilled())throw new Error("Promise is not fulfilled");return this.d},Promise.prototype.reason=function(){if(!this.isRejected())throw new Error("Promise is not rejected");return this.d},Promise.prototype.suppressUnhandledRejections=function(){this.l()},Promise.prototype.inspect=function(){return this.toString()},Promise.prototype.toString=function(){var t;switch(this.c){case 0:t="pending";break;case 1:t="fulfilled";break;case 2:t="rejected";break;default:t="unknown"}return"[Promise "+this.b+": "+t+"]"},Promise.prototype.delay=function(t){return this.then(function(e){return new Promise(function(n){setTimeout(function(){return n(e)},t)})})},Promise.prototype.return=function(t){return void 0===t?this.then(o):this.then(function(){return t})},Promise.prototype.throw=function(t){return this.then(function(){return Promise.reject(t)})},Promise.prototype.h=function(t){this.g&&t.g&&this.g.setSource(t.g)},Promise.prototype.i=function(t){if(h.assert(0===this.c),!t)return void this.m(t);if(this===t)return void this.j(new TypeError("cannot resolve Promise to self"));if(t instanceof Promise)return t.h(this),t.l(),void(0===t.c?this.n(t):1===t.c?this.m(t.d):this.j(t.d));if("object"==typeof t||"function"==typeof t){var e=this.o(t);if(e===y)return void this.j(r(y.error));if("function"==typeof e)return void this.p(t,e)}this.m(t)},Promise.prototype.o=function(t){try{var e=t.then;return e}catch(t){return y.error=t,y}},Promise.prototype.m=function(t){h.assert(0===this.c),s&&s(this,"_fulfill("+typeof t+")"),this.c=1,this.d=t,this.q()},Promise.prototype.j=function(t){if(h.assert(0===this.c),s&&s(this,"_reject("+t+")"),this.c=2,this.d=t,this.g&&this.d instanceof Error&&!this.d.trace){var e=this.g;this.d.trace=e;var n=this.d.stack;n&&Object.defineProperty(this.d,"stack",{enumerable:!1,get:function(){return n+"\n  from Promise at:\n"+e.inspect()}})}1&this.f||c.default.enqueueIdle(Promise.r,this),this.q()},Promise.prototype.l=function(){!(1&this.f)&&2&this.f&&c.default.enqueue(Promise.s,this),this.f|=1,s&&s(this,"rejectionHandled")},Promise.prototype.t=function(){1&this.f||2&this.f||(this.f|=2,c.default.enqueue(Promise.u,this))},Promise.prototype.n=function(t){h.assert(0===this.c),s&&s(this,"_follow([Promise "+t.b+"])"),t.k(void 0,void 0,this,void 0)},Promise.prototype.p=function(t,e){var n=this;h.assert(0===this.c),s&&s(this,"_follow([Thenable])");var i=!1;try{e.call(t,function(t){i||(i=!0,n.i(t))},function(t){i||(i=!0,n.j(r(t)))})}catch(t){i||(i=!0,this.j(r(t)))}},Promise.prototype.k=function(t,e,n,i){var o={promise:this,onFulfilled:t,onRejected:e,slave:n,done:i};if(0!==this.c)c.default.enqueue(Promise.v,o);else if(this.e){var r=this.e.length;this.e[r]=o}else this.e=[o];this.l()},Promise.prototype.q=function(){if(this.e){var t=0,e=this.e,n=e.length;for(this.e=void 0;t<n;)c.default.enqueue(Promise.v,e[t++])}},Promise.prototype.w=function(t){var e=1===this.c?t.onFulfilled:t.onRejected;if(t.done){if(s&&s(this,"_unwrap()"),"function"!=typeof e)return void(2===this.c&&Promise.x(this.d,t.done));h.assert(!p),p=this;try{var n=e(this.d);if(n){var i=n instanceof Promise?n:Promise.resolve(n);i.done()}p=void 0}catch(e){p=void 0,Promise.x(e,t.done)}}else{var o=t.slave;if(s&&s(this,"_unwrap("+o.b+")"),"function"==typeof e){h.assert(!p),p=o;try{o.i(e(this.d))}catch(t){o.j(r(t))}p=void 0}else 1===this.c?o.m(this.d):o.j(this.d)}},Promise.resolve=function(t){var e=new Promise(i);return e.i(t),e},Promise.reject=function(t){var e=new Promise(i);return e.j(t),e},Promise.all=function(t){return new Promise(function(e,n){function i(t,i){var s=t instanceof Promise?t:Promise.resolve(t);s.done(function(t){o[i]=t,r--,0===r&&e(o)},function(t){return n(t)})}if(h.assert(Array.isArray(t),"thenables must be an Array"),0===t.length)return void e([]);for(var o=new Array(t.length),r=t.length,s=0;s<t.length;s++)i(t[s],s)})},Promise.race=function(t){return new Promise(function(e,n){h.assert(Array.isArray(t),"thenables must be an Array");for(var i=0,o=t;i<o.length;i++){var r=o[i],s=r instanceof Promise?r:Promise.resolve(r);Promise.resolve(s).done(e,n)}})},Promise.defer=function(){var t,e,n=new Promise(function(n,i){t=n,e=i});return{promise:n,reject:e,resolve:t}},Promise.delay=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(void 0===arguments[1]){var n=arguments[0];return new Promise(function(t){setTimeout(t,n)})}return Promise.resolve(arguments[0]).delay(arguments[1])},Promise.onUnhandledRejection=function(t){if(t===!0)Promise.x=f.defaultUnhandledRejectionHandler;else if(t===!1)Promise.x=o;else{if("function"!=typeof t)throw new TypeError("invalid handler: boolean or function expected");Promise.x=t}},Promise.onPossiblyUnhandledRejection=function(t){if(t===!0)Promise.u=f.defaultPossiblyUnhandledRejectionHandler;else if(t===!1)Promise.u=o;else{if("function"!=typeof t)throw new TypeError("invalid handler: boolean or function expected");Promise.u=t}},Promise.onPossiblyUnhandledRejectionHandled=function(t){if(t===!0)Promise.s=f.defaultPossiblyUnhandledRejectionHandledHandler;else if(t===!1)Promise.s=o;else{if("function"!=typeof t)throw new TypeError("invalid handler: boolean or function expected");Promise.s=t}},Promise.setLongTraces=function(t){l=t},Promise.setTracer=function(t){s="function"==typeof t?t:void 0},Promise.flush=function(){c.default.flush()},Promise.v=function(t){t.promise.w(t)},Promise.r=function(t){t.t()},Promise}();n.Promise=Promise,Promise.onUnhandledRejection(!0),Promise.onPossiblyUnhandledRejection(!0),Promise.onPossiblyUnhandledRejectionHandled(!0),n.default=Promise},{"./Trace":4,"./async":5,"./rejections":8,"./util":9}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Error.captureStackTrace,o=function(){function t(e){void 0===e&&(e=t),i?Error.captureStackTrace(this,e):this.stack="dummy\n<no trace>"}return t.prototype.inspect=function(){var t=this.stack.split("\n");return t.shift(),t.join("\n")},t}();n.default=o},{}],4:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./Stack"),o=function(){function t(e){void 0===e&&(e=t),this.stack=new i.default(e)}return t.prototype.setSource=function(e){e.sources?(this.sources=e.sources.concat(e.stack),this.sources.length>t.traceLimit&&(this.sources=this.sources.slice(0,t.traceLimit))):this.sources=[e.stack]},t.prototype.inspect=function(){var t=this.stack.inspect();if(this.sources)for(var e=this.sources.length-1;e>=0;e--)t+="\n  from previous:\n"+this.sources[e].inspect();return t},t.traceLimit=10,t}();n.default=o},{"./Stack":3}],5:[function(t,e,n){"use strict";function i(t){"function"==typeof setImmediate?setImmediate(t):setTimeout(t,0)}Object.defineProperty(n,"__esModule",{value:!0});var o=t("./util"),r=function(){function t(){this.length=0,this.y=1e3,this.z=0}return t.prototype.push=function(t,e){return this[this.length++]=t,this[this.length++]=e,this.length<this.y},t.prototype.flush=function(){for(;this.z<this.length;){var t=this[this.z],e=this[this.z+1];this[this.z]=this[this.z+1]=void 0,this.z+=2,t(e)}this.length=0,this.z=0},t.prototype.empty=function(){return this.z===this.length},t}(),s=function(){function t(t){this.A=[new r],this.B=this.A[0],this.C=t}return t.prototype.enqueue=function(t,e){this.B||(this.B=this.C.pop(),this.B||(this.B=new r),this.A.push(this.B)),this.B.push(t,e)||(this.B=void 0)},t.prototype.flush=function(){for(;;){if(this.A[0].flush(),1===this.A.length)break;this.C.push(this.A.shift())}this.B=this.A[0]},t.prototype.empty=function(){return 1===this.A.length&&this.A[0].empty()},t}(),u=function(){function t(){var t=this;this.C=[],this.D=new s(this.C),this.F=new s(this.C),this.G=!1,this.H=!1,this.I=void 0,this.J=function(){return t.K()}}return t.prototype.setScheduler=function(t){o.assert(void 0===t||null===t||"function"==typeof t),this.I=t},t.prototype.enqueue=function(t,e){this.G||this.H||this.L(),this.D.enqueue(t,e)},t.prototype.enqueueIdle=function(t,e){this.G||this.H||this.L(),this.F.enqueue(t,e)},t.prototype.flush=function(){o.assert(!this.G,"cannot recursively flush"),this.G=!0;try{for(;;){if(this.D.flush(),this.F.empty())break;var t=this.D;this.D=this.F,this.F=t}}finally{this.G=!1,this.D.empty()&&this.F.empty()||this.H||this.L()}},t.prototype.L=function(){o.assert(!this.H);var t=this.I||i;t(this.J),this.H=!0},t.prototype.K=function(){this.H=!1,this.flush()},t}();n.Async=u,n.async=new u,n.default=n.async},{"./util":9}],6:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t("./Promise");n.default=i.default,n.Promise=i.Promise;var o=t("./Trace");n.Trace=o.default;var r=t("./rejections");n.UnhandledRejection=r.UnhandledRejection,n.PossiblyUnhandledRejection=r.PossiblyUnhandledRejection;var s=t("./rejections");n.UnhandledRejectionError=s.UnhandledRejection;var u=t("./polyfill");n.polyfill=u.default;var c=t("./BaseError");n.BaseError=c.default},{"./BaseError":1,"./Promise":2,"./Trace":4,"./polyfill":7,"./rejections":8}],7:[function(t,e,n){"use strict";function i(t){void 0===t&&(t=!1);var e=r.getGlobal();return!!e&&(t||"function"!=typeof e.Promise?(e.Promise=o.Promise,!0):e.Promise instanceof o.Promise)}Object.defineProperty(n,"__esModule",{value:!0});var o=t("./Promise"),r=t("./util");n.default=i},{"./Promise":2,"./util":9}],8:[function(t,e,n){"use strict";function i(t,e,n){var i=new PromiseRejectionEvent(t,{cancelable:!0,promise:!0,reason:e});Object.defineProperty(i,"promise",{value:n});var o=f.getGlobal();return!(!o.dispatchEvent||o.dispatchEvent(i))}function o(t,e){var n=new h(t,e);throw n}function r(t){var e=!0;if("undefined"!=typeof process&&"function"==typeof process.emit?process.emit("unhandledRejection",t.reason(),t)&&(e=!1):"function"==typeof PromiseRejectionEvent&&i("unhandledrejection",t.reason(),t)&&(e=!1),e){var n=new l(t);console.warn(n.stack)}}function s(t){"undefined"!=typeof process&&"function"==typeof process.emit?process.emit("rejectionHandled",t):"function"==typeof PromiseRejectionEvent&&i("rejectionhandled",t.reason(),t)}var u=this&&this.a||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(n,"__esModule",{value:!0});var c=t("./BaseError"),f=t("./util"),a=function(t){function e(e,n,i){var o=t.call(this,e,n+": "+i)||this;o.reason=i;var r=o.reason&&"object"==typeof o.reason&&o.reason.stack;return"string"!=typeof r&&(r=String(o.reason)),o.stack=o.name+": "+r,o}return u(e,t),e}(c.default);n.BaseUnhandledRejection=a;var h=function(t){function e(e,n){var i=t.call(this,"UnhandledRejection","unhandled rejection",e)||this;return i.trace=n,i}return u(e,t),e}(a);n.UnhandledRejection=h;var l=function(t){function e(e){var n=t.call(this,"PossiblyUnhandledRejection","possibly unhandled rejection",e.reason())||this;return n.promise=e,n}return u(e,t),e}(a);n.PossiblyUnhandledRejection=l,n.defaultUnhandledRejectionHandler=o,n.defaultPossiblyUnhandledRejectionHandler=r,n.defaultPossiblyUnhandledRejectionHandledHandler=s},{"./BaseError":1,"./util":9}],9:[function(t,e,n){"use strict";function i(t,e){if(!t)throw new Error(e?"assertion failed: "+e:"assertion failed")}function o(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;var t;try{t=new Function("return this")()}catch(t){}return t}Object.defineProperty(n,"__esModule",{value:!0}),n.assert=i,n.getGlobal=o},{}]},{},[6])(6)});
